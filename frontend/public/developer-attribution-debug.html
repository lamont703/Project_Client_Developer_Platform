<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Attribution Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        #results {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîç Developer Attribution Debug</h1>
        <p>This page helps debug developer attribution issues.</p>

        <div class="test-section">
            <h3>üß™ Test URLs</h3>
            <button class="test-button"
                onclick="testURL('http://localhost:3000/ai-assistant?ref=lamont_evans&source=email')">Test
                lamont_evans</button>
            <button class="test-button"
                onclick="testURL('http://localhost:3000/ai-assistant?ref=dantee_fluellen&source=linkedin')">Test
                dantee_fluellen</button>
            <button class="test-button"
                onclick="testURL('http://localhost:3000/ai-assistant?ref=julian_faulkner&source=twitter')">Test
                julian_faulkner</button>
            <button class="test-button" onclick="testURL('http://localhost:3000/ai-assistant')">Test No
                Attribution</button>
        </div>

        <div class="test-section">
            <h3>üîß Manual Tests</h3>
            <button class="test-button" onclick="testCurrentURL()">Test Current URL</button>
            <button class="test-button" onclick="testDeveloperTracker()">Test DeveloperTracker</button>
            <button class="test-button" onclick="testAnalytics()">Test Analytics</button>
            <button class="test-button" onclick="sendTestEvent()">Send Test Event</button>
        </div>

        <div class="test-section">
            <h3>üìä Current Status</h3>
            <div id="status"></div>
        </div>

        <div id="results"></div>
    </div>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BS2Y73PXX8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-BS2Y73PXX8');
    </script>

    <script>
        // Mock DeveloperTracker for testing
        class MockDeveloperTracker {
            constructor() {
                this.sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                this.developerRef = null;
                this.loadDeveloperRef();
            }

            extractDeveloperRefFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const developerId = urlParams.get('ref');
                const source = urlParams.get('source') || 'direct';

                if (!developerId) return null;

                const developerNames = {
                    'lamont_evans': 'Lamont Evans',
                    'lamont': 'Lamont Evans',
                    'dantee_fluellen': 'Dantee Fluellen',
                    'dantee': 'Dantee Fluellen',
                    'julian_faulkner': 'Julian Faulkner',
                    'julian': 'Julian Faulkner'
                };

                const developerName = developerNames[developerId] || developerId;

                this.developerRef = {
                    developerId,
                    developerName,
                    source,
                    timestamp: new Date().toISOString(),
                    sessionId: this.sessionId
                };

                this.saveDeveloperRef();
                return this.developerRef;
            }

            getDeveloperRef() {
                return this.developerRef;
            }

            getAttributionData() {
                if (!this.developerRef) return {};

                return {
                    developerRef: this.developerRef.developerId,
                    developerName: this.developerRef.developerName,
                    source: this.developerRef.source,
                    sessionId: this.developerRef.sessionId,
                    attributionChain: `${this.developerRef.developerId} ‚Üí user ‚Üí conversion`
                };
            }

            saveDeveloperRef() {
                try {
                    localStorage.setItem('developer_referral', JSON.stringify(this.developerRef));
                } catch (error) {
                    console.error('Error saving developer referral:', error);
                }
            }

            loadDeveloperRef() {
                try {
                    const stored = localStorage.getItem('developer_referral');
                    if (stored) {
                        this.developerRef = JSON.parse(stored);
                    }
                } catch (error) {
                    console.error('Error loading developer referral:', error);
                }
            }
        }

        // Mock Analytics for testing
        class MockAnalytics {
            constructor() {
                this.developerTracker = new MockDeveloperTracker();
            }

            trackAIAssistantEvent(event, metadata = {}) {
                const attributionData = this.developerTracker.getAttributionData();
                const eventData = {
                    event_category: 'ai_project_assistant',
                    ...attributionData,
                    ...metadata
                };

                console.log('üìä AI Assistant Event:', event, eventData);

                if (typeof window.gtag === 'function') {
                    window.gtag('event', `ai_assistant_${event}`, eventData);
                    addResult(`‚úÖ AI Assistant event sent: ai_assistant_${event}`, 'success');
                } else {
                    addResult('‚ùå gtag not available', 'error');
                }
            }

            trackSlotEvent(event, slotName, metadata = {}) {
                const attributionData = this.developerTracker.getAttributionData();
                const eventData = {
                    event_category: 'slot_engine',
                    slot_name: slotName,
                    ...attributionData,
                    ...metadata
                };

                console.log('üìä Slot Event:', event, eventData);

                if (typeof window.gtag === 'function') {
                    window.gtag('event', `slot_${event}`, eventData);
                    addResult(`‚úÖ Slot event sent: slot_${event}`, 'success');
                } else {
                    addResult('‚ùå gtag not available', 'error');
                }
            }
        }

        let testResults = [];

        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            resultsDiv.appendChild(resultDiv);

            testResults.push({ message, type, timestamp: new Date() });
        }

        function updateStatus() {
            const statusDiv = document.getElementById('status');
            const developerTracker = new MockDeveloperTracker();
            const developerRef = developerTracker.extractDeveloperRefFromURL();

            let statusHTML = '';

            if (developerRef) {
                statusHTML += `<div class="result success">‚úÖ Developer Attribution Found: ${developerRef.developerName} (${developerRef.developerId})</div>`;
                statusHTML += `<div class="result info">Source: ${developerRef.source}</div>`;
                statusHTML += `<div class="result info">Session ID: ${developerRef.sessionId}</div>`;
            } else {
                statusHTML += `<div class="result error">‚ùå No Developer Attribution Found</div>`;
            }

            statusHTML += `<div class="result info">Current URL: ${window.location.href}</div>`;
            statusHTML += `<div class="result info">gtag available: ${typeof window.gtag === 'function' ? '‚úÖ' : '‚ùå'}</div>`;

            statusDiv.innerHTML = statusHTML;
        }

        function testURL(url) {
            addResult(`Testing URL: ${url}`, 'info');
            window.location.href = url;
        }

        function testCurrentURL() {
            addResult('Testing current URL...', 'info');
            const developerTracker = new MockDeveloperTracker();
            const developerRef = developerTracker.extractDeveloperRefFromURL();

            if (developerRef) {
                addResult(`‚úÖ Developer ref extracted: ${developerRef.developerName}`, 'success');
                addResult(`Attribution data: ${JSON.stringify(developerTracker.getAttributionData(), null, 2)}`, 'info');
            } else {
                addResult('‚ùå No developer ref found in current URL', 'error');
            }
        }

        function testDeveloperTracker() {
            addResult('Testing DeveloperTracker...', 'info');
            const developerTracker = new MockDeveloperTracker();
            const developerRef = developerTracker.extractDeveloperRefFromURL();

            addResult(`DeveloperTracker instance created`, 'info');
            addResult(`Developer ref: ${developerRef ? 'Found' : 'Not found'}`, developerRef ? 'success' : 'error');

            if (developerRef) {
                addResult(`Developer ID: ${developerRef.developerId}`, 'info');
                addResult(`Developer Name: ${developerRef.developerName}`, 'info');
                addResult(`Source: ${developerRef.source}`, 'info');
            }
        }

        function testAnalytics() {
            addResult('Testing Analytics...', 'info');
            const analytics = new MockAnalytics();

            addResult('Analytics instance created', 'info');
            addResult('Testing AI Assistant event...', 'info');

            analytics.trackAIAssistantEvent('test_event', {
                testData: 'manual_test',
                timestamp: Date.now()
            });
        }

        function sendTestEvent() {
            addResult('Sending test event to Google Analytics...', 'info');

            if (typeof window.gtag === 'function') {
                window.gtag('event', 'developer_attribution_test', {
                    event_category: 'test',
                    event_label: 'developer_attribution_debug',
                    developerRef: 'test_developer',
                    source: 'debug_page',
                    timestamp: Date.now()
                });
                addResult('‚úÖ Test event sent to Google Analytics', 'success');
            } else {
                addResult('‚ùå gtag not available', 'error');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function () {
            updateStatus();
            addResult('Debug page loaded', 'info');
        });

        // Update status every 5 seconds
        setInterval(updateStatus, 5000);
    </script>
</body>

</html>